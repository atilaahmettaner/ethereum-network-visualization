{"version":3,"file":"index-array-by.js","sources":["../src/index.js"],"sourcesContent":["export default (list = [], keyAccessors = [], multiItem = true, flattenKeys = false) => {\n\n  const keys = (keyAccessors instanceof Array\n    ? (keyAccessors.length ? keyAccessors : [undefined])\n    : [keyAccessors]).map(key => ({\n    keyAccessor: key,\n    isProp: !(key instanceof Function)\n  }));\n\n  const indexedResult = list.reduce((res, item) => {\n    let iterObj = res;\n    let itemVal = item;\n\n    keys.forEach(({ keyAccessor, isProp }, idx) => {\n      let key;\n      if (isProp) {\n        const { [keyAccessor]: propVal, ...rest } = itemVal;\n        key = propVal;\n        itemVal = rest;\n      } else {\n        key = keyAccessor(itemVal, idx);\n      }\n\n      if (idx + 1 < keys.length) {\n        if (!iterObj.hasOwnProperty(key)) {\n          iterObj[key] = {};\n        }\n        iterObj = iterObj[key];\n      } else { // Leaf key\n        if (multiItem) {\n          if (!iterObj.hasOwnProperty(key)) {\n            iterObj[key] = [];\n          }\n          iterObj[key].push(itemVal);\n        } else {\n          iterObj[key] = itemVal;\n        }\n      }\n    });\n    return res;\n  }, {});\n\n  if (multiItem  instanceof Function) {\n    // Reduce leaf multiple values\n    (function reduce(node, level = 1) {\n      if (level === keys.length) {\n        Object.keys(node).forEach(k => node[k] = multiItem(node[k]));\n      } else {\n        Object.values(node).forEach(child => reduce(child, level + 1));\n      }\n    })(indexedResult); // IIFE\n  }\n\n  let result = indexedResult;\n\n  if (flattenKeys) {\n    // flatten into array\n    result = [];\n\n    (function flatten(node, accKeys = []) {\n      if (accKeys.length === keys.length) {\n        result.push({\n          keys: accKeys,\n          vals: node\n        });\n      } else {\n        Object.entries(node)\n          .forEach(([key, val]) => flatten(val, [...accKeys, key]));\n      }\n    })(indexedResult); //IIFE\n\n    if (keyAccessors instanceof Array && keyAccessors.length === 0 && result.length === 1) {\n      // clear keys if there's no key accessors (single result)\n      result[0].keys = [];\n    }\n  }\n\n  return result;\n}\n"],"names":["list","keyAccessors","multiItem","flattenKeys","keys","Array","length","undefined","map","key","keyAccessor","isProp","Function","indexedResult","reduce","res","item","iterObj","itemVal","forEach","idx","propVal","rest","hasOwnProperty","push","node","level","Object","k","values","child","result","flatten","accKeys","vals","entries","val"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA,cAAA,CAAe,YAAyE;IAAA,IAAxEA,IAAwE,uEAAjE,EAAiE,CAAA;IAAA,IAA7DC,YAA6D,uEAA9C,EAA8C,CAAA;IAAA,IAA1CC,SAA0C,uEAA9B,IAA8B,CAAA;IAAA,IAAxBC,WAAwB,uEAAV,KAAU,CAAA;IAEtF,IAAMC,IAAI,GAAG,CAACH,YAAY,YAAYI,KAAxB,GACTJ,YAAY,CAACK,MAAb,GAAsBL,YAAtB,GAAqC,CAACM,SAAD,CAD5B,GAEV,CAACN,YAAD,CAFS,EAEOO,GAFP,CAEW,UAAAC,GAAG,EAAA;MAAA,OAAK;EAC9BC,MAAAA,WAAW,EAAED,GADiB;EAE9BE,MAAAA,MAAM,EAAE,EAAEF,GAAG,YAAYG,QAAjB,CAAA;OAFiB,CAAA;EAAA,GAFd,CAAb,CAAA;IAOA,IAAMC,aAAa,GAAGb,IAAI,CAACc,MAAL,CAAY,UAACC,GAAD,EAAMC,IAAN,EAAe;MAC/C,IAAIC,OAAO,GAAGF,GAAd,CAAA;MACA,IAAIG,OAAO,GAAGF,IAAd,CAAA;EAEAZ,IAAAA,IAAI,CAACe,OAAL,CAAa,UAAA,IAAA,EAA0BC,GAA1B,EAAkC;QAAA,IAA/BV,WAA+B,QAA/BA,WAA+B;YAAlBC,MAAkB,QAAlBA,MAAkB,CAAA;EAC7C,MAAA,IAAIF,GAAJ,CAAA;;EACA,MAAA,IAAIE,MAAJ,EAAY;EACV,QAAA,IAAA,QAAA,GAA4CO,OAA5C;cAAuBG,OAAvB,YAASX,WAAT,CAAA;cAAmCY,IAAnC,uCAASZ,WAAT,CAAA,CAAA,GAAA,CAAA,cAAA,CAAA,CAAA,CAAA;;EACAD,QAAAA,GAAG,GAAGY,OAAN,CAAA;EACAH,QAAAA,OAAO,GAAGI,IAAV,CAAA;EACD,OAJD,MAIO;EACLb,QAAAA,GAAG,GAAGC,WAAW,CAACQ,OAAD,EAAUE,GAAV,CAAjB,CAAA;EACD,OAAA;;EAED,MAAA,IAAIA,GAAG,GAAG,CAAN,GAAUhB,IAAI,CAACE,MAAnB,EAA2B;EACzB,QAAA,IAAI,CAACW,OAAO,CAACM,cAAR,CAAuBd,GAAvB,CAAL,EAAkC;EAChCQ,UAAAA,OAAO,CAACR,GAAD,CAAP,GAAe,EAAf,CAAA;EACD,SAAA;;EACDQ,QAAAA,OAAO,GAAGA,OAAO,CAACR,GAAD,CAAjB,CAAA;EACD,OALD,MAKO;EAAE;EACP,QAAA,IAAIP,SAAJ,EAAe;EACb,UAAA,IAAI,CAACe,OAAO,CAACM,cAAR,CAAuBd,GAAvB,CAAL,EAAkC;EAChCQ,YAAAA,OAAO,CAACR,GAAD,CAAP,GAAe,EAAf,CAAA;EACD,WAAA;;EACDQ,UAAAA,OAAO,CAACR,GAAD,CAAP,CAAae,IAAb,CAAkBN,OAAlB,CAAA,CAAA;EACD,SALD,MAKO;EACLD,UAAAA,OAAO,CAACR,GAAD,CAAP,GAAeS,OAAf,CAAA;EACD,SAAA;EACF,OAAA;OAxBH,CAAA,CAAA;EA0BA,IAAA,OAAOH,GAAP,CAAA;KA9BoB,EA+BnB,EA/BmB,CAAtB,CAAA;;IAiCA,IAAIb,SAAS,YAAaU,QAA1B,EAAoC;EAClC;EACA,IAAA,CAAC,SAASE,MAAT,CAAgBW,IAAhB,EAAiC;QAAA,IAAXC,KAAW,uEAAH,CAAG,CAAA;;EAChC,MAAA,IAAIA,KAAK,KAAKtB,IAAI,CAACE,MAAnB,EAA2B;UACzBqB,MAAM,CAACvB,IAAP,CAAYqB,IAAZ,EAAkBN,OAAlB,CAA0B,UAAAS,CAAC,EAAA;YAAA,OAAIH,IAAI,CAACG,CAAD,CAAJ,GAAU1B,SAAS,CAACuB,IAAI,CAACG,CAAD,CAAL,CAAvB,CAAA;WAA3B,CAAA,CAAA;EACD,OAFD,MAEO;UACLD,MAAM,CAACE,MAAP,CAAcJ,IAAd,EAAoBN,OAApB,CAA4B,UAAAW,KAAK,EAAA;EAAA,UAAA,OAAIhB,MAAM,CAACgB,KAAD,EAAQJ,KAAK,GAAG,CAAhB,CAAV,CAAA;WAAjC,CAAA,CAAA;EACD,OAAA;OALH,EAMGb,aANH,CAAA,CAFkC;;EASnC,GAAA;;IAED,IAAIkB,MAAM,GAAGlB,aAAb,CAAA;;EAEA,EAAA,IAAIV,WAAJ,EAAiB;EACf;EACA4B,IAAAA,MAAM,GAAG,EAAT,CAAA;;EAEA,IAAA,CAAC,SAASC,OAAT,CAAiBP,IAAjB,EAAqC;QAAA,IAAdQ,OAAc,uEAAJ,EAAI,CAAA;;EACpC,MAAA,IAAIA,OAAO,CAAC3B,MAAR,KAAmBF,IAAI,CAACE,MAA5B,EAAoC;UAClCyB,MAAM,CAACP,IAAP,CAAY;EACVpB,UAAAA,IAAI,EAAE6B,OADI;EAEVC,UAAAA,IAAI,EAAET,IAAAA;WAFR,CAAA,CAAA;EAID,OALD,MAKO;EACLE,QAAAA,MAAM,CAACQ,OAAP,CAAeV,IAAf,CAAA,CACGN,OADH,CACW,UAAA,KAAA,EAAA;EAAA,UAAA,IAAA,KAAA,GAAA,cAAA,CAAA,KAAA,EAAA,CAAA,CAAA;EAAA,cAAEV,GAAF,GAAA,KAAA,CAAA,CAAA,CAAA;EAAA,cAAO2B,GAAP,GAAA,KAAA,CAAA,CAAA,CAAA,CAAA;;EAAA,UAAA,OAAgBJ,OAAO,CAACI,GAAD,+BAAUH,OAAV,CAAA,EAAA,CAAmBxB,GAAnB,CAAvB,CAAA,CAAA,CAAA;WADX,CAAA,CAAA;EAED,OAAA;OATH,EAUGI,aAVH,CAAA,CAJe;;;EAgBf,IAAA,IAAIZ,YAAY,YAAYI,KAAxB,IAAiCJ,YAAY,CAACK,MAAb,KAAwB,CAAzD,IAA8DyB,MAAM,CAACzB,MAAP,KAAkB,CAApF,EAAuF;EACrF;EACAyB,MAAAA,MAAM,CAAC,CAAD,CAAN,CAAU3B,IAAV,GAAiB,EAAjB,CAAA;EACD,KAAA;EACF,GAAA;;EAED,EAAA,OAAO2B,MAAP,CAAA;EACD,CA9ED;;;;;;;;"}