{"version":3,"file":"kapsule.js","sources":["../node_modules/debounce/index.js","../src/index.js"],"sourcesContent":["/**\n * Returns a function, that, as long as it continues to be invoked, will not\n * be triggered. The function will be called after it stops being called for\n * N milliseconds. If `immediate` is passed, trigger the function on the\n * leading edge, instead of the trailing. The function also has a property 'clear' \n * that is a function which will clear the timer to prevent previously scheduled executions. \n *\n * @source underscore.js\n * @see http://unscriptable.com/2009/03/20/debouncing-javascript-methods/\n * @param {Function} function to wrap\n * @param {Number} timeout in ms (`100`)\n * @param {Boolean} whether to execute at the beginning (`false`)\n * @api public\n */\nfunction debounce(func, wait, immediate){\n  var timeout, args, context, timestamp, result;\n  if (null == wait) wait = 100;\n\n  function later() {\n    var last = Date.now() - timestamp;\n\n    if (last < wait && last >= 0) {\n      timeout = setTimeout(later, wait - last);\n    } else {\n      timeout = null;\n      if (!immediate) {\n        result = func.apply(context, args);\n        context = args = null;\n      }\n    }\n  };\n\n  var debounced = function(){\n    context = this;\n    args = arguments;\n    timestamp = Date.now();\n    var callNow = immediate && !timeout;\n    if (!timeout) timeout = setTimeout(later, wait);\n    if (callNow) {\n      result = func.apply(context, args);\n      context = args = null;\n    }\n\n    return result;\n  };\n\n  debounced.clear = function() {\n    if (timeout) {\n      clearTimeout(timeout);\n      timeout = null;\n    }\n  };\n  \n  debounced.flush = function() {\n    if (timeout) {\n      result = func.apply(context, args);\n      context = args = null;\n      \n      clearTimeout(timeout);\n      timeout = null;\n    }\n  };\n\n  return debounced;\n};\n\n// Adds compatibility for ES modules\ndebounce.debounce = debounce;\n\nmodule.exports = debounce;\n","import debounce from 'debounce';\n\nclass Prop {\n  constructor(name, {\n    default: defaultVal = null,\n    triggerUpdate = true,\n    onChange = (newVal, state) => {}\n  }) {\n    this.name = name;\n    this.defaultVal = defaultVal;\n    this.triggerUpdate = triggerUpdate;\n    this.onChange = onChange;\n  }\n}\n\nexport default function ({\n  stateInit = (() => ({})),\n  props: rawProps = {},\n  methods = {},\n  aliases = {},\n  init: initFn = (() => {}),\n  update: updateFn = (() => {})\n}) {\n\n  // Parse props into Prop instances\n  const props = Object.keys(rawProps).map(propName =>\n    new Prop(propName, rawProps[propName])\n  );\n\n  return function(options = {}) {\n\n    // Holds component state\n    let state = Object.assign({},\n      stateInit instanceof Function ? stateInit(options) : stateInit, // Support plain objects for backwards compatibility\n      { initialised: false }\n    );\n\n    // keeps track of which props triggered an update\n    let changedProps = {};\n\n    // Component constructor\n    function comp(nodeElement) {\n      initStatic(nodeElement, options);\n      digest();\n\n      return comp;\n    }\n\n    const initStatic = function(nodeElement, options) {\n      initFn.call(comp, nodeElement, state, options);\n      state.initialised = true;\n    };\n\n    const digest = debounce(() => {\n      if (!state.initialised) { return; }\n      updateFn.call(comp, state, changedProps);\n      changedProps = {};\n    }, 1);\n\n    // Getter/setter methods\n    props.forEach(prop => {\n      comp[prop.name] = getSetProp(prop);\n\n      function getSetProp({\n        name: prop,\n        triggerUpdate: redigest = false,\n        onChange = (newVal, state) => {},\n        defaultVal = null\n      }) {\n        return function(_) {\n          const curVal = state[prop];\n          if (!arguments.length) { return curVal } // Getter mode\n\n          const val = _ === undefined ? defaultVal : _; // pick default if value passed is undefined\n          state[prop] = val;\n          onChange.call(comp, val, state, curVal);\n\n          // track changed props\n          !changedProps.hasOwnProperty(prop) && (changedProps[prop] = curVal);\n\n          if (redigest) { digest(); }\n          return comp;\n        }\n      }\n    });\n\n    // Other methods\n    Object.keys(methods).forEach(methodName => {\n      comp[methodName] = (...args) => methods[methodName].call(comp, state, ...args);\n    });\n\n    // Link aliases\n    Object.entries(aliases).forEach(([alias, target]) => comp[alias] = comp[target]);\n\n    // Reset all component props to their default value\n    comp.resetProps = function() {\n      props.forEach(prop => {\n        comp[prop.name](prop.defaultVal);\n      });\n      return comp;\n    };\n\n    //\n\n    comp.resetProps(); // Apply all prop defaults\n    state._rerender = digest; // Expose digest method\n\n    return comp;\n  }\n}\n"],"names":["Prop","name","defaultVal","triggerUpdate","onChange","newVal","state","stateInit","props","rawProps","methods","aliases","init","initFn","update","updateFn","Object","keys","map","propName","options","assign","Function","initialised","changedProps","comp","nodeElement","initStatic","digest","call","debounce","forEach","prop","getSetProp","redigest","_","curVal","arguments","length","val","undefined","hasOwnProperty","methodName","args","entries","alias","target","resetProps","_rerender"],"mappings":"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"}